<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Expense Tracker</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body>
  <nav class="navbar navbar-expand-md navbar-dark bg-dark mb-4">
    <div class="container">
      <a class="navbar-brand" href="/">ExpenseTracker</a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <% if (!user) { %>
            <li class="nav-item"><a class="nav-link" href="/login">Login</a></li>
            <li class="nav-item"><a class="nav-link" href="/register">Register</a></li>
          <% } else { %>
            <li class="nav-item"><a class="nav-link" href="/dashboard">Dashboard</a></li>
            <li class="nav-item"><a class="nav-link" href="/expenses">Expenses</a></li>
            <li class="nav-item"><a class="nav-link" href="/logout">Logout</a></li>
          <% } %>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container">
    <% 
      // Normalize messages: could be undefined, string, or array. Convert to arrays and filter empties.
      const sMsgs = (typeof success_msg === 'string' && success_msg.trim()) ? [success_msg] : (Array.isArray(success_msg) ? success_msg : []);
      const eMsgs = (typeof error_msg === 'string' && error_msg.trim()) ? [error_msg] : (Array.isArray(error_msg) ? error_msg : []);
      const passportErr = (typeof error === 'string' && error.trim()) ? [error] : (Array.isArray(error) ? error : []);
      const allMsgsExist = (sMsgs.length + eMsgs.length + passportErr.length) > 0;
    %>

    <% if (allMsgsExist) { %>
      <% sMsgs.forEach(function(m) { %>
        <div class="alert alert-success"><%= m %></div>
      <% }) %>
      <% eMsgs.forEach(function(m) { %>
        <div class="alert alert-danger"><%= m %></div>
      <% }) %>
      <% passportErr.forEach(function(m) { %>
        <div class="alert alert-danger"><%= m %></div>
      <% }) %>
    <% } %>
